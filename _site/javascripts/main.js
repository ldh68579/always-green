// Generated by CoffeeScript 1.8.0
$(window).load(function() {
  firebase.auth().onAuthStateChanged(function(user) {
    window.logged_in_user = null;
    $('html').removeClass('logged-in');
    if (user) {
      return firebase.database().ref("users/" + user.uid + "/access_token").once('value', function(profile_doc) {
        if (profile_doc.val()) {
          window.logged_in_user = user;
          return $('html').addClass('logged-in');
        } else {
          return firebase.auth().signOut();
        }
      });
    }
  });
  return $('.github-login').on('click', function(e) {
    var provider;
    provider = new firebase.auth.GithubAuthProvider();
    provider.addScope('public_repo');
    return firebase.auth().signInWithPopup(provider).then(function(data) {
      return firebase.database().ref("users/" + data.user.uid).once('value', function(profile_doc) {
        return profile_doc.child('access_token').ref.set(data.credential.accessToken);
      });
    })["catch"](function(error) {
      return console.log(error);
    });
  });
});
